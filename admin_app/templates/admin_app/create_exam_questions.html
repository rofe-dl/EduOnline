{% extends "admin_app/index.html" %}

{% block title %}
    <title>Create Exam - {{request.user.username}} | EduOnline</title>
{% endblock %}

{% block b1 %}
<div id="create-exam-questions-div">
    <h2>Create Exam</h2>

    <button id="create-question-btn" type="button">Create Question</button>

    <div class="questions-div">
    </div>

    {% include "admin_app/template_question_choice.html" %}
    
</div>

<script>
    /**
     * Sets the value of every radio option in the question form 
     * to the value of the text field beside it.
     * 
     * @param {Form} questionForm The question form it will act on
     */
    function setRadioValues(questionForm){

        questionForm.find('input[type=radio]').each(function(){
            let radio = $(this);
            radio.val(radio.closest("div").find("input[type=text]").val());
        })
    }

    $(document).on('submit', '.empty-question-form', function(event){
        event.preventDefault();
        var questionForm = $(this);
        setRadioValues(questionForm);
        
        let dataArray = questionForm.serializeArray()
        var posting = $.post(questionForm.attr('action'), jQuery.param(dataArray));

        posting.done(function(){
            questionForm.find(".submit-question-btn").prop('disabled', true);
            questionForm.find(".remove-question-btn").prop('disabled', true);
            questionForm.find(".add-choice-btn").prop('disabled', true);
        })
    })

    $("#create-question-btn").click(function() {
        $(".questions-div").append($("#empty-question").html())
    })

    $(document).on('click', '.add-choice-btn', function(){ 
        //didn't use just .click as above because elements are dynamically generated and may not exist when script runs
        $(this).closest("form").append($('#empty-choice').html());
    })

    $(document).on('click', '.remove-choice-btn', function(){
        $(this).closest(".choice-div").remove();
    })

    // only works on .empty-question-form, meaning the newly created questions
    $(document).on('click', '.empty-question-form .remove-question-btn', function(){
        $(this).closest("form").remove();
    })

</script>
{% endblock %}